<!--modified hero layout-->

{{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
{{ $disableHeroImageFilter := .Site.Params.homepage.disableHeroImageFilter | default false }}

{{ $imageBreakpointSmall := "450px" }}
{{ $imageBreakpointMedium := "600px" }}
{{ $imageBreakpointLarge := "750px" }}
{{ partial "home/hero-image-rendition.html" . }}

<div class="homepage-hero">
  {{ if .Params.images }}
      <picture class="homepage-hero__picture">
        <source media="(min-width: {{ $imageBreakpointLarge }})" srcset="">
        <source media="(min-width: {{ $imageBreakpointMedium }})" srcset="">
        <source media="(min-width: {{ $imageBreakpointSmall }})" srcset="">
        <img id="target-hero" 
            class="nozoom" 
            src="">
      </picture>
  {{ end }}

  <div class="homepage-hero__content">
    <div id="target-question" class="question">
      How many<br />
      devices is a<br />
      lifetime
    </div>

    <img class='logo' src="/logo.svg" />
  </div>

</div>

<section class="prose prose-invert">
  {{ .Content }}
</section>

<section>
  {{ partial "recent-articles/main.html" . }}
</section>

<section class='partners'>
  <img src="/images/partners/cream_Logo_Goethe_Institut.svg">
  <img src="/images/partners/cream_victoria_logo.svg" >
  <img src="/images/partners/cream_Monash_University_logo.svg" >
  <img src="/images/partners/cream_Massey_University_Logo.svg" >
  <img src="/images/partners/cream_Toi_Aria_Logo.svg" >
</section>

<script>
const questions = {{ .Params.questions }}
const processedImages = window.heroImages || []

let currentImageIndex = 0
setHeroImage()
setHeroText()

const PERIOD = 7000
setInterval(setHeroText, PERIOD)
setInterval(setHeroImage, PERIOD)

function setHeroText () {
  const text = questions[random(questions.length)]
  const heroTextEl = document.getElementById('target-question')
  heroTextEl.innerText = text
}

// don't cycle to the current image, always choose a different one
function getNextImageIndex (currentIndex, maxIndex) {
  const allIndices = Array.from({ length: maxIndex }, (_, i) => i)
  const availableIndices = allIndices.filter(i => i !== currentIndex)
  return availableIndices[random(availableIndices.length)]
}

function updatePictureSources (pictureEl, imageSet) {
  const sources = pictureEl.querySelectorAll('source')

  sources.forEach(source => {
    const media = source.getAttribute('media')
    if (media?.includes("{{ $imageBreakpointLarge }}")) {
      source.srcset = imageSet.large
    } else if (media?.includes("{{ $imageBreakpointMedium }}")) {
      source.srcset = imageSet.medium
    } else if (media?.includes("{{ $imageBreakpointSmall }}")) {
      source.srcset = imageSet.small
    }
  })
}

function setHeroImage() {
  if (processedImages.length <= 1) return

  const heroImageEl = document.getElementById('target-hero')
  const pictureEl = heroImageEl.parentElement

  if (pictureEl?.tagName === 'PICTURE') {
    currentImageIndex = getNextImageIndex(currentImageIndex, processedImages.length)
    const imageSet = processedImages[currentImageIndex]

    updatePictureSources(pictureEl, imageSet)
    heroImageEl.src = imageSet.base
  }
}

function random (n) {
  return Math.floor(Math.random() * n)
}
</script>

<style>
:where(body):has(.homepage-hero) {
  /* this page's components will handle their own inline spacing */
  margin: unset;
  padding-inline: unset;
  max-inline-size: unset;

  :where(.main-menu, main > *, footer) {
    /* the same content container styles are applied to each component, so they 
    can be individually overridden as needed (e.g. for full-bleed layouts) */
    width: 100%;
    max-width: var(--content-max-width-plus-gutters);
    margin-inline: auto;
    padding-inline: var(--page-gutter);
  }
  /* main-menu's padding is set inline though, so higher specificity is needed */
  .main-menu {
    padding-inline: var(--page-gutter) !important;
  }
}

.homepage-hero {
  /* allow children (specifically the image) to be full-bleed */
  max-width: unset;
  margin-inline: unset;
  padding-inline: unset;

  height: clamp(25rem, 62.5vw, 30rem); 
  display: grid;
  grid-template-rows: minmax(0, 1fr); /* https://css-tricks.com/preventing-a-grid-blowout/ */
  grid-template-areas: "a"; 
  place-items: center;
  margin-bottom: 2rem;

  & > * {
    /* picture + content will be overlaid in the same area */
    grid-area: a;
    width: 100%;
    height: 100%;
  }
}

.homepage-hero__picture {
  overflow: hidden;
  
  :where(img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    
  }
}

.homepage-hero__content {
  /*  standard content container settings */
  max-width: var(--content-max-width-plus-gutters);
  margin-inline: auto;
  padding-inline: var(--page-gutter);

  padding-block: 4.5rem 3.5rem;
  display: grid;
  align-content: space-between;
  
  @media (min-width: 768px) {
    padding-block: 5rem 4rem;
   }
  @media (min-width: 1024px) {
    padding-block: 4rem 3rem;
   }

  :where(.question) {
    justify-self: start;
    max-width: 40rem;
    font-size: 2.5rem;
    line-height: 1.125;
    font-family: bold_font;
    text-transform: uppercase;
    text-wrap: balance;
    filter: drop-shadow(0 0 5px rgba(0,0,0, 0.2));

    @media (min-width: 768px) {
      font-size: 4rem;
    }
  }

  :where(.logo) {
    height: 3rem;
    justify-self: end;
    filter: drop-shadow(0 0 5px rgba(0,0,0, 0.6));

    @media (min-width: 768px) {
      height: 4rem;
    }
  }
}


.prose {
  margin-bottom: 3rem;
}

/* Partners section */
.partners {
  margin: 6rem -1rem 4rem -1rem;
  max-width: calc(100% + 2rem);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-content: center;
  gap: 2rem;

  @media (min-width: 768px) {
    gap: 3rem;
  }

  :where(img) {
    max-height: 5rem;
    min-width: 25%;
    max-width: calc(100% / 2 - 2rem);
    
    @media (min-width: 768px) {
      max-width: calc(100% / 3 - 2rem);
    }
  }
}
</style>
